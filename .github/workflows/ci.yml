name: Test setup-php with PHP 8.1

on: [push, pull_request]

jobs:
  test:
    runs-on: 'ubuntu-latest'

    strategy:
      fail-fast: false
      matrix:
        include:
          - php: '8.1'

    steps:
      - name: Check for redis files before setup-php
        if: ${{ !cancelled() }}
        run: find /etc/php -name \*redis\*

      - name: Setup PHP ${{ matrix.php }}
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php }}

      - name: Check for redis files after setup-php
        if: ${{ !cancelled() }}
        run: find /etc/php -name \*redis\*

      - name: Find setup-php script
        if: ${{ !cancelled() }}
        run: find /home/runner/work/_actions/shivammathur/setup-php/v2/src/scripts/ -name \*.sh

      - name: Make sure cancelled jobs are marked as failures.
        if: ${{ cancelled() }}
        run: exit 1
